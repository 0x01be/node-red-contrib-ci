[
    {
        "id": "5aabf089.3ea8d",
        "type": "tab",
        "label": "Pipeline",
        "disabled": false,
        "info": ""
    },
    {
        "id": "6dc3181b.94ee6",
        "type": "swagger-doc",
        "z": "",
        "summary": "",
        "description": "",
        "tags": "pipeline",
        "consumes": "",
        "produces": "",
        "parameters": [],
        "responses": {
            "201": {
                "description": "Created"
            }
        },
        "deprecated": false
    },
    {
        "id": "45ece1d1.7a3e98",
        "type": "docker-config",
        "z": "",
        "protocol": "http",
        "hostname": "docker",
        "port": "1234"
    },
    {
        "id": "56a66bde.68bccc",
        "type": "elasticsearch-config",
        "z": "",
        "index": "events",
        "protocol": "http",
        "hostname": "elasticsearch",
        "port": 9200
    },
    {
        "id": "190d4eb1.a0ea49",
        "type": "build-image",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "remote": "",
        "nocache": false,
        "pull": false,
        "x": 490,
        "y": 140,
        "wires": [
            [
                "d8025478.3647"
            ],
            [
                "8e555fcb.3bc618"
            ]
        ]
    },
    {
        "id": "d8025478.3647",
        "type": "create-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 330,
        "y": 60,
        "wires": [
            [
                "80f83fd8.4c705"
            ]
        ]
    },
    {
        "id": "e9a2cea.9387eb",
        "type": "start-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 330,
        "y": 360,
        "wires": [
            [
                "2be013cb.8e7f6c",
                "98782112.ace9c8"
            ]
        ]
    },
    {
        "id": "2be013cb.8e7f6c",
        "type": "read-logs",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "follow": true,
        "stderr": true,
        "x": 330,
        "y": 280,
        "wires": [
            [
                "9cbcfbb3.fd7fc",
                "8e555fcb.3bc618"
            ]
        ]
    },
    {
        "id": "d60da5d0.b9d66",
        "type": "http in",
        "z": "5aabf089.3ea8d",
        "name": "",
        "url": "/build",
        "method": "post",
        "upload": false,
        "swaggerDoc": "6dc3181b.94ee6",
        "x": 130,
        "y": 200,
        "wires": [
            [
                "45d9d91e.c2e128",
                "67a711b1.6be8b8"
            ]
        ]
    },
    {
        "id": "9cbcfbb3.fd7fc",
        "type": "function",
        "z": "5aabf089.3ea8d",
        "name": "Node-RED started",
        "func": "const expected = 'Started flows';\n\nconst success = (typeof msg.payload.stream === 'string')\n                && msg.payload.stream.includes(expected);\n\nif (success) {\n    node.send(msg);\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 150,
        "y": 420,
        "wires": [
            [
                "859abcbc.f05f2"
            ]
        ]
    },
    {
        "id": "859abcbc.f05f2",
        "type": "stop-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 330,
        "y": 420,
        "wires": [
            [
                "98782112.ace9c8"
            ]
        ]
    },
    {
        "id": "67a711b1.6be8b8",
        "type": "http response",
        "z": "5aabf089.3ea8d",
        "name": "created",
        "statusCode": "201",
        "headers": {},
        "x": 320,
        "y": 200,
        "wires": []
    },
    {
        "id": "8e555fcb.3bc618",
        "type": "function",
        "z": "5aabf089.3ea8d",
        "name": "cleanup",
        "func": "if (msg.payload.stream) {\n    msg.payload.stream = msg.payload.stream.replace('\\r\\n','').trim();\n    \n    const regexp = /[0-9]{2} [A-Z][a-z][a-z] [0-9]{2}:[0-9]{2}:[0-9]{2} - /;\n    \n    if (regexp.test(msg.payload.stream)) {\n        msg.payload.stream = msg.payload.stream.substring(18).trim();\n        node.send(msg);\n    } else if (msg.payload.stream !== \"\") {\n        node.send(msg);\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 500,
        "y": 280,
        "wires": [
            [
                "1a89a7dc.89848"
            ]
        ]
    },
    {
        "id": "45d9d91e.c2e128",
        "type": "function",
        "z": "5aabf089.3ea8d",
        "name": "commit",
        "func": "const commit = msg.payload.commits[0].id;\nconst repository = msg.payload.repository.clone_url;\nconst url = msg.payload.commits[0].url.replace('commit', 'raw');\nconst remote = `${url}/Dockerfile`;\n\nmsg.payload = {\n    commit: commit,\n    repository: repository,\n    remote: remote,\n    time: new Date()\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 320,
        "y": 140,
        "wires": [
            [
                "190d4eb1.a0ea49"
            ]
        ]
    },
    {
        "id": "80f83fd8.4c705",
        "type": "inspect-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 500,
        "y": 60,
        "wires": [
            [
                "e9a2cea.9387eb",
                "1a89a7dc.89848"
            ]
        ]
    },
    {
        "id": "98782112.ace9c8",
        "type": "inspect-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 500,
        "y": 360,
        "wires": [
            [
                "1a89a7dc.89848"
            ]
        ]
    },
    {
        "id": "1a89a7dc.89848",
        "type": "persist-event",
        "z": "5aabf089.3ea8d",
        "name": "",
        "elasticsearch": "56a66bde.68bccc",
        "x": 680,
        "y": 240,
        "wires": []
    },
    {
        "id": "63c68c7f.1fb604",
        "type": "comment",
        "z": "5aabf089.3ea8d",
        "name": "Welcome",
        "info": "Wecome to your pipeline!",
        "x": 120,
        "y": 60,
        "wires": []
    }
]