[
    {
        "id": "5aabf089.3ea8d",
        "type": "tab",
        "label": "Pipeline",
        "disabled": false,
        "info": ""
    },
    {
        "id": "6dc3181b.94ee6",
        "type": "swagger-doc",
        "z": "",
        "summary": "",
        "description": "",
        "tags": "pipeline",
        "consumes": "",
        "produces": "",
        "parameters": [],
        "responses": {
            "201": {
                "description": "Created"
            }
        },
        "deprecated": false
    },
    {
        "id": "45ece1d1.7a3e98",
        "type": "docker-config",
        "z": "",
        "protocol": "http",
        "hostname": "docker",
        "port": "2375"
    },
    {
        "id": "56a66bde.68bccc",
        "type": "elasticsearch-config",
        "z": "",
        "index": "events",
        "protocol": "http",
        "hostname": "elasticsearch",
        "port": 9200
    },
    {
        "id": "190d4eb1.a0ea49",
        "type": "build-image",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "remote": "",
        "nocache": false,
        "pull": true,
        "x": 470,
        "y": 60,
        "wires": [
            [
                "d8025478.3647"
            ],
            [
                "e300e4ff.6b4cd8"
            ]
        ]
    },
    {
        "id": "d8025478.3647",
        "type": "create-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 470,
        "y": 120,
        "wires": [
            [
                "31a17023.1a6488"
            ]
        ]
    },
    {
        "id": "2be013cb.8e7f6c",
        "type": "read-logs",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "follow": true,
        "stderr": false,
        "x": 310,
        "y": 260,
        "wires": [
            [
                "9cbcfbb3.fd7fc",
                "8e555fcb.3bc618"
            ]
        ]
    },
    {
        "id": "d60da5d0.b9d66",
        "type": "http in",
        "z": "5aabf089.3ea8d",
        "name": "",
        "url": "/build",
        "method": "post",
        "upload": false,
        "swaggerDoc": "6dc3181b.94ee6",
        "x": 110,
        "y": 120,
        "wires": [
            [
                "45d9d91e.c2e128",
                "67a711b1.6be8b8"
            ]
        ]
    },
    {
        "id": "9cbcfbb3.fd7fc",
        "type": "function",
        "z": "5aabf089.3ea8d",
        "name": "Node-RED âœ“",
        "func": "const expected = 'Started flows';\n\nconst success = (typeof msg.payload.stream === 'string')\n                && msg.payload.stream.includes(expected);\n\nif (success) {\n    node.send(msg);\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "e7d85b49.d5e818"
            ]
        ]
    },
    {
        "id": "67a711b1.6be8b8",
        "type": "http response",
        "z": "5aabf089.3ea8d",
        "name": "created",
        "statusCode": "201",
        "headers": {},
        "x": 280,
        "y": 120,
        "wires": []
    },
    {
        "id": "8e555fcb.3bc618",
        "type": "function",
        "z": "5aabf089.3ea8d",
        "name": "cleanup",
        "func": "if (msg.payload.stream) {\n    msg.payload.stream = msg.payload.stream.replace('\\r\\n','').trim();\n    \n    const regexp = /[0-9]{1,2} [A-Z][a-z][a-z] [0-9]{2}:[0-9]{2}:[0-9]{2} - /;\n    \n    if (regexp.test(msg.payload.stream)) {\n        msg.payload.stream = msg.payload.stream.replace(regexp,'').trim();\n        node.send(msg);\n    } else if (msg.payload.stream !== \"\") {\n        node.send(msg);\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "e300e4ff.6b4cd8"
            ]
        ]
    },
    {
        "id": "45d9d91e.c2e128",
        "type": "function",
        "z": "5aabf089.3ea8d",
        "name": "commit",
        "func": "const commit = msg.payload.commits[0].id;\nconst repository = msg.payload.repository.clone_url;\nconst url = msg.payload.commits[0].url.replace('commit', 'raw');\nconst remote = `${url}/Dockerfile`;\n\nmsg.payload = {\n    commit: commit.substring(0, 15),\n    repository: repository,\n    remote: remote,\n    time: new Date()\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 300,
        "y": 60,
        "wires": [
            [
                "190d4eb1.a0ea49"
            ]
        ]
    },
    {
        "id": "e300e4ff.6b4cd8",
        "type": "index-event",
        "z": "5aabf089.3ea8d",
        "name": "",
        "elasticsearch": "56a66bde.68bccc",
        "x": 630,
        "y": 200,
        "wires": []
    },
    {
        "id": "31a17023.1a6488",
        "type": "start-stop-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "operation": "start",
        "docker": "45ece1d1.7a3e98",
        "x": 310,
        "y": 200,
        "wires": [
            [
                "2be013cb.8e7f6c"
            ]
        ]
    },
    {
        "id": "e7d85b49.d5e818",
        "type": "start-stop-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "operation": "stop",
        "docker": "45ece1d1.7a3e98",
        "x": 310,
        "y": 340,
        "wires": [
            [
                "d3e07a27.fac058"
            ]
        ]
    },
    {
        "id": "d3e07a27.fac058",
        "type": "remove-container",
        "z": "5aabf089.3ea8d",
        "name": "",
        "docker": "45ece1d1.7a3e98",
        "x": 480,
        "y": 340,
        "wires": [
            []
        ]
    }
]